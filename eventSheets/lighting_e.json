{
	"name": "lighting_e",
	"events": [
		{
			"eventType": "variable",
			"name": "isLightingOn",
			"type": "boolean",
			"initialValue": "false",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 301801699180556
		},
		{
			"eventType": "variable",
			"name": "isShadowsOn",
			"type": "boolean",
			"initialValue": "false",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 627484870719445
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "Lighting",
			"description": "",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "comment",
					"text": "debug lighting"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-in-preview",
							"objectClass": "System",
							"sid": 358578234286067
						}
					],
					"actions": [],
					"sid": 889284471482019,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "every-tick",
									"objectClass": "System",
									"sid": 159677553340591
								}
							],
							"actions": [],
							"sid": 798646047768214,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "pick-all",
											"objectClass": "System",
											"sid": 983530377545136,
											"parameters": {
												"object": "ambientLightAura"
											}
										}
									],
									"actions": [
										{
											"id": "set-size",
											"objectClass": "ambientLightAura",
											"sid": 383179833523736,
											"parameters": {
												"width": "Self.Width + Self.Sine.Value",
												"height": "Self.Height+ Self.Sine.Value"
											}
										}
									],
									"sid": 963570879130378
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "key-is-down",
									"objectClass": "Keyboard",
									"sid": 490540404743176,
									"parameters": {
										"key": 38
									}
								}
							],
							"actions": [],
							"sid": 225852404643523,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "pick-all",
											"objectClass": "System",
											"sid": 749434003651412,
											"parameters": {
												"object": "lightSource"
											}
										},
										{
											"id": "pick-all",
											"objectClass": "System",
											"sid": 222175224774487,
											"parameters": {
												"object": "ambientLightAura"
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "lightSource",
											"sid": 215567954841197,
											"parameters": {
												"instance-variable": "brightness",
												"value": "clamp(Self.brightness + 1, 0, 100)"
											}
										},
										{
											"id": "set-scale",
											"objectClass": "ambientLightAura",
											"sid": 352013919976328,
											"parameters": {
												"scale": "clamp(lightSource.brightness * .01, .01, 1)"
											}
										}
									],
									"sid": 153398557193263,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "pick-children",
													"objectClass": "lightSource",
													"sid": 392801132737987,
													"parameters": {
														"child": "lightAura",
														"which": "own"
													}
												}
											],
											"actions": [
												{
													"callFunction": "setLightRadius",
													"sid": 863899393005928
												}
											],
											"sid": 785968731458482
										}
									]
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 628953635244733
								},
								{
									"id": "key-is-down",
									"objectClass": "Keyboard",
									"sid": 115326380463049,
									"parameters": {
										"key": 40
									}
								}
							],
							"actions": [],
							"sid": 610547107722202,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "pick-all",
											"objectClass": "System",
											"sid": 598042366160225,
											"parameters": {
												"object": "lightSource"
											}
										},
										{
											"id": "pick-all",
											"objectClass": "System",
											"sid": 897151399561942,
											"parameters": {
												"object": "ambientLightAura"
											}
										}
									],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "lightSource",
											"sid": 633287793656732,
											"parameters": {
												"instance-variable": "brightness",
												"value": "clamp(Self.brightness - 1, 0, 100)"
											}
										},
										{
											"id": "set-scale",
											"objectClass": "ambientLightAura",
											"sid": 852713071741542,
											"parameters": {
												"scale": "clamp(lightSource.brightness * .01, .01, 1)"
											}
										}
									],
									"sid": 189898099578256,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "pick-children",
													"objectClass": "lightSource",
													"sid": 151797540358536,
													"parameters": {
														"child": "lightAura",
														"which": "own"
													}
												}
											],
											"actions": [
												{
													"callFunction": "setLightRadius",
													"sid": 844943150655521
												}
											],
											"sid": 442630418769212
										}
									]
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 870857669991554
								},
								{
									"id": "key-is-down",
									"objectClass": "Keyboard",
									"sid": 623054828220817,
									"parameters": {
										"key": 187
									}
								}
							],
							"actions": [
								{
									"callFunction": "setDarkness",
									"sid": 918943814046960,
									"parameters": [
										"clamp(LayerOpacity(darknessLayer) + 1, 0, 100)"
									]
								}
							],
							"sid": 635367853312704
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 758875745309520
								},
								{
									"id": "key-is-down",
									"objectClass": "Keyboard",
									"sid": 713835018444849,
									"parameters": {
										"key": 189
									}
								}
							],
							"actions": [
								{
									"callFunction": "setDarkness",
									"sid": 745962294655118,
									"parameters": [
										"clamp(LayerOpacity(darknessLayer) - 1, -1, 100)"
									]
								}
							],
							"sid": 584254262846439
						}
					]
				},
				{
					"eventType": "variable",
					"name": "lightingLayer",
					"type": "string",
					"initialValue": "lights",
					"comment": "",
					"isStatic": false,
					"isConstant": true,
					"sid": 113119422772515
				},
				{
					"eventType": "variable",
					"name": "darknessLayer",
					"type": "string",
					"initialValue": "darkness",
					"comment": "",
					"isStatic": false,
					"isConstant": true,
					"sid": 810468298766209
				},
				{
					"eventType": "variable",
					"name": "lightingParentLayer",
					"type": "string",
					"initialValue": "lighting",
					"comment": "",
					"isStatic": false,
					"isConstant": true,
					"sid": 967162485561693
				},
				{
					"functionName": "initLighting",
					"functionDescription": "",
					"functionCategory": "lighting",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [],
					"eventType": "function-block",
					"conditions": [],
					"actions": [],
					"sid": 394494215155857,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-in-preview",
									"objectClass": "System",
									"sid": 368753418592108
								}
							],
							"actions": [
								{
									"callFunction": "throwIf",
									"sid": 564278032472861,
									"parameters": [
										"LayerIndex(lightingParentLayer)",
										"-1",
										"\"The lighting layer '\"& lightingParentLayer& \"' on layout '\" & LayoutName & \"' is missing\""
									]
								},
								{
									"callFunction": "throwIf",
									"sid": 250592871655045,
									"parameters": [
										"LayerIndex(lightingLayer)",
										"-1",
										"\"The lighting layer '\"& lightingLayer & \"' on layout '\" & LayoutName & \"' is missing\""
									]
								},
								{
									"callFunction": "throwIf",
									"sid": 974884486215148,
									"parameters": [
										"LayerIndex(darknessLayer)",
										"-1",
										"\"The lighting layer '\"& darknessLayer & \"' on layout '\" & LayoutName & \"' is missing\""
									]
								},
								{
									"callFunction": "throwIf",
									"sid": 534475319279241,
									"disabled": true,
									"parameters": [
										"Functions.doesLayerEffectExist(lightingLayer, \"Multiply\")",
										"0",
										"\"The lighting layer '\"& lightingLayer & \"' on layout '\" & LayoutName & \"' is missing Multiply effect\""
									]
								}
							],
							"sid": 492050774359666
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "set-group-active",
									"objectClass": "System",
									"sid": 693127282403760,
									"parameters": {
										"group-name": "\"Rim Light\"",
										"state": "activated"
									}
								},
								{
									"id": "set-layer-force-own-texture",
									"objectClass": "System",
									"sid": 512247082906622,
									"parameters": {
										"layer": "lightingParentLayer",
										"mode": "on"
									}
								},
								{
									"id": "set-layer-transparent",
									"objectClass": "System",
									"sid": 127989474254905,
									"parameters": {
										"layer": "darknessLayer",
										"mode": "opaque"
									}
								},
								{
									"id": "set-layer-background-color",
									"objectClass": "System",
									"sid": 358717239327449,
									"parameters": {
										"layer": "darknessLayer",
										"color": "rgbEx(0, 0, 0)"
									}
								},
								{
									"id": "set-layer-opacity",
									"objectClass": "System",
									"sid": 640639368668829,
									"parameters": {
										"layer": "darknessLayer",
										"opacity": "20"
									}
								},
								{
									"id": "set-layer-blend-mode",
									"objectClass": "System",
									"sid": 600751549636176,
									"parameters": {
										"layer": "lightingLayer",
										"blend-mode": "source-out"
									}
								},
								{
									"id": "set-layer-blend-mode",
									"objectClass": "System",
									"sid": 885419163469182,
									"parameters": {
										"layer": "darknessLayer",
										"blend-mode": "source-out"
									}
								},
								{
									"id": "set-layer-visible",
									"objectClass": "System",
									"sid": 799855393487811,
									"parameters": {
										"layer": "lightingParentLayer",
										"visibility": "visible"
									}
								},
								{
									"id": "set-layer-visible",
									"objectClass": "System",
									"sid": 385027493117428,
									"parameters": {
										"layer": "darknessLayer",
										"visibility": "visible"
									}
								},
								{
									"id": "set-layer-visible",
									"objectClass": "System",
									"sid": 303326747343132,
									"parameters": {
										"layer": "lightingLayer",
										"visibility": "visible"
									}
								},
								{
									"id": "set-boolean-eventvar",
									"objectClass": "System",
									"sid": 796980558821614,
									"parameters": {
										"variable": "isLightingOn",
										"value": "true"
									}
								},
								{
									"id": "set-boolean-eventvar",
									"objectClass": "System",
									"sid": 114318455760405,
									"parameters": {
										"variable": "isShadowsOn",
										"value": "true"
									}
								}
							],
							"sid": 413811430857220
						}
					]
				},
				{
					"functionName": "setDarkness",
					"functionDescription": "",
					"functionCategory": "lighting",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "darkness",
							"type": "number",
							"initialValue": "10",
							"comment": "",
							"sid": 681535696966310
						}
					],
					"eventType": "function-block",
					"conditions": [],
					"actions": [],
					"sid": 751040462696704,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 584298821566665,
									"parameters": {
										"variable": "darkness",
										"comparison": 3,
										"value": "0"
									}
								}
							],
							"actions": [
								{
									"type": "comment",
									"text": "disable lighting"
								},
								{
									"id": "set-layer-visible",
									"objectClass": "System",
									"sid": 528201618641259,
									"parameters": {
										"layer": "lightingParentLayer",
										"visibility": "invisible"
									}
								},
								{
									"id": "set-boolean-eventvar",
									"objectClass": "System",
									"sid": 701227004653603,
									"parameters": {
										"variable": "isLightingOn",
										"value": "false"
									}
								}
							],
							"sid": 471744805933614,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "pick-all",
											"objectClass": "System",
											"sid": 977814197167007,
											"parameters": {
												"object": "dolls"
											}
										}
									],
									"actions": [
										{
											"id": "set-effect-enabled",
											"objectClass": "dolls",
											"sid": 393082523959357,
											"parameters": {
												"mode": "disable",
												"effect": "\"RimLight\""
											}
										}
									],
									"sid": 783319319673519
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 232531966963945
								}
							],
							"actions": [],
							"sid": 703073153524282,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-boolean-eventvar",
											"objectClass": "System",
											"sid": 570627509621524,
											"parameters": {
												"variable": "isLightingOn"
											},
											"isInverted": true
										}
									],
									"actions": [
										{
											"callFunction": "initLighting",
											"sid": 324071762548359
										}
									],
									"sid": 208250702830849
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-layer-opacity",
											"objectClass": "System",
											"sid": 502764626049663,
											"parameters": {
												"layer": "darknessLayer",
												"opacity": "darkness"
											}
										}
									],
									"sid": 616516056779543
								}
							]
						}
					]
				},
				{
					"functionName": "calculateBellCurve",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "number",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "curDistance",
							"type": "number",
							"initialValue": "-1",
							"comment": "",
							"sid": 501213235989690
						},
						{
							"name": "peakDistance",
							"type": "number",
							"initialValue": "-1",
							"comment": "",
							"sid": 112280805319399
						},
						{
							"name": "variance",
							"type": "number",
							"initialValue": "-1",
							"comment": "",
							"sid": 586734082884211
						}
					],
					"eventType": "function-block",
					"conditions": [],
					"actions": [],
					"sid": 613688911789722,
					"children": [
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "set-function-return-value",
									"objectClass": "Functions",
									"sid": 554192773649475,
									"parameters": {
										"value": "100 * (exp( -(( curDistance - peakDistance) ^ 2) / (2 * variance ^ 2)))"
									}
								}
							],
							"sid": 174651411855320
						}
					]
				},
				{
					"eventType": "comment",
					"text": "fake light glow around units"
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "Bloom",
					"description": "",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-created",
									"objectClass": "glowEmitters",
									"sid": 793503063457553
								}
							],
							"actions": [
								{
									"id": "spawn-another-object",
									"objectClass": "glowEmitters",
									"sid": 415827850551142,
									"parameters": {
										"object": "glowAmbientMask",
										"layer": "lightingLayer",
										"image-point": "\"center\"",
										"create-hierarchy": false
									}
								},
								{
									"id": "add-child",
									"objectClass": "glowEmitters",
									"sid": 382177300440176,
									"parameters": {
										"child": "glowAmbientMask",
										"transform-x": true,
										"transform-y": true,
										"transform-w": false,
										"transform-h": false,
										"transform-a": false,
										"transform-o": false,
										"transform-z-elevation": false,
										"transform-visibility": false,
										"destroy-with-parent": true
									}
								}
							],
							"sid": 839522256215315,
							"children": [
								{
									"eventType": "comment",
									"text": "Use a slightly smaller glow for non actuals objects"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "pick-by-unique-id",
											"objectClass": "spr_playerActual",
											"sid": 831413930195755,
											"parameters": {
												"unique-id": "glowEmitters.UID"
											}
										}
									],
									"actions": [
										{
											"id": "set-animation",
											"objectClass": "glowAmbientMask",
											"sid": 411882602919384,
											"parameters": {
												"animation": "\"dimmer\"",
												"from": "beginning"
											}
										},
										{
											"id": "set-size",
											"objectClass": "glowAmbientMask",
											"sid": 569063936546244,
											"parameters": {
												"width": "spr_playerActual.Height * 4",
												"height": "spr_playerActual.Height * 4"
											}
										}
									],
									"sid": 848336568655499
								},
								{
									"eventType": "comment",
									"text": "Use a slightly smaller glow for non actuals objects"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 516829638108770
										},
										{
											"id": "pick-by-unique-id",
											"objectClass": "actuals",
											"sid": 858211813897267,
											"parameters": {
												"unique-id": "glowEmitters.UID"
											}
										}
									],
									"actions": [
										{
											"id": "set-animation",
											"objectClass": "glowAmbientMask",
											"sid": 470792319555157,
											"parameters": {
												"animation": "\"brighter\"",
												"from": "beginning"
											}
										},
										{
											"id": "set-size",
											"objectClass": "glowAmbientMask",
											"sid": 675118182609200,
											"parameters": {
												"width": "actuals.Height * 4",
												"height": "actuals.Height * 4"
											}
										}
									],
									"sid": 644919612176928
								},
								{
									"eventType": "comment",
									"text": "Use a slightly smaller glow for non actuals objects"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 528953428213158
										}
									],
									"actions": [
										{
											"id": "set-animation",
											"objectClass": "glowAmbientMask",
											"sid": 702258831437830,
											"parameters": {
												"animation": "\"dimmer\"",
												"from": "beginning"
											}
										},
										{
											"id": "set-size",
											"objectClass": "glowAmbientMask",
											"sid": 424397189264473,
											"parameters": {
												"width": "glowEmitters.Height* 3",
												"height": "glowEmitters.Height * 3"
											}
										}
									],
									"sid": 307063522510811
								}
							]
						},
						{
							"eventType": "comment",
							"text": "this is for replacing light source spawn points"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-created",
									"objectClass": "spawnGlowMask",
									"sid": 626334579320073
								}
							],
							"actions": [
								{
									"id": "spawn-another-object",
									"objectClass": "spawnGlowMask",
									"sid": 715321969233581,
									"parameters": {
										"object": "glowAmbientMask",
										"layer": "lightingLayer",
										"image-point": "\"center\"",
										"create-hierarchy": false
									}
								}
							],
							"sid": 466926838907644,
							"children": [
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-animation",
											"objectClass": "glowAmbientMask",
											"sid": 377746384175620,
											"parameters": {
												"animation": "\"dimmer\"",
												"from": "beginning"
											}
										},
										{
											"id": "set-size",
											"objectClass": "glowAmbientMask",
											"sid": 924574106607867,
											"parameters": {
												"width": "spawnGlowMask.Width",
												"height": "spawnGlowMask.Height"
											}
										},
										{
											"id": "destroy",
											"objectClass": "spawnGlowMask",
											"sid": 487602138905204
										}
									],
									"sid": 830838919596163
								}
							]
						}
					],
					"sid": 810222749848555
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "lightSource",
					"description": "",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-created",
									"objectClass": "lightSource",
									"sid": 558726563769000
								}
							],
							"actions": [
								{
									"id": "set-animation-frame",
									"objectClass": "lightSource",
									"sid": 221052614653437,
									"parameters": {
										"frame-number": "random(0, Self.AnimationFrameCount)"
									}
								}
							],
							"sid": 989372407458652,
							"children": [
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"callFunction": "throwIf",
											"sid": 132632911844639,
											"parameters": [
												"int(str(lightSource.ImagePointX(\"light\")) &  str(lightSource.ImagePointY(\"light\")))",
												"int(str(lightSource.X) & str(lightSource.Y))",
												"\"lightSource '\" & lightSource.ObjectTypeName & \"' of uid: '\" & lightSource.UID & \"' missing light origin point\""
											]
										},
										{
											"id": "create-object",
											"objectClass": "System",
											"sid": 324415961020846,
											"parameters": {
												"object-to-create": "ambientLightAura",
												"layer": "lightingLayer",
												"x": "lightSource.ImagePointX(\"light\")",
												"y": "lightSource.ImagePointY(\"light\")",
												"create-hierarchy": true,
												"template-name": "\"\""
											}
										},
										{
											"id": "add-child",
											"objectClass": "lightSource",
											"sid": 523620002399223,
											"parameters": {
												"child": "ambientLightAura",
												"transform-x": true,
												"transform-y": true,
												"transform-w": true,
												"transform-h": true,
												"transform-a": true,
												"transform-o": true,
												"transform-z-elevation": true,
												"transform-visibility": true,
												"destroy-with-parent": true
											}
										},
										{
											"id": "set-scale",
											"objectClass": "ambientLightAura",
											"sid": 152761526357341,
											"parameters": {
												"scale": "clamp(lightSource.brightness * .01, .01, 1)"
											}
										},
										{
											"id": "create-object",
											"objectClass": "System",
											"sid": 696159034982196,
											"disabled": true,
											"parameters": {
												"object-to-create": "ambientShadow",
												"layer": "\"shadowLayer\"",
												"x": "lightSource.ImagePointX(\"light\")",
												"y": "lightSource.ImagePointY(\"light\")",
												"create-hierarchy": true,
												"template-name": "\"\""
											}
										},
										{
											"id": "add-child",
											"objectClass": "ambientLightAura",
											"sid": 431003261242722,
											"disabled": true,
											"parameters": {
												"child": "ambientShadow",
												"transform-x": true,
												"transform-y": true,
												"transform-w": true,
												"transform-h": true,
												"transform-a": true,
												"transform-o": true,
												"transform-z-elevation": true,
												"transform-visibility": true,
												"destroy-with-parent": true
											}
										},
										{
											"id": "set-visible",
											"objectClass": "ambientShadow",
											"sid": 210881576998338,
											"disabled": true,
											"parameters": {
												"visibility": "invisible"
											}
										},
										{
											"id": "set-active",
											"objectClass": "ambientLightAura",
											"sid": 467954292714134,
											"behaviorType": "Sine",
											"parameters": {
												"state": "active"
											}
										}
									],
									"sid": 573321558521308,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "pick-by-unique-id",
													"objectClass": "lightAura",
													"sid": 605764411883118,
													"parameters": {
														"unique-id": "ambientLightAura.UID"
													}
												}
											],
											"actions": [
												{
													"callFunction": "setLightRadius",
													"sid": 128743325785587
												}
											],
											"sid": 272505016553746
										}
									]
								}
							]
						},
						{
							"functionName": "setLightRadius",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": true,
							"functionIsAsync": false,
							"functionParameters": [],
							"eventType": "function-block",
							"conditions": [],
							"actions": [],
							"sid": 138963383518408,
							"children": [
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-instvar-value",
											"objectClass": "lightAura",
											"sid": 497041017924665,
											"parameters": {
												"instance-variable": "radius",
												"value": "lightAura.Width / 2"
											}
										},
										{
											"id": "set-range",
											"objectClass": "lightAura",
											"sid": 198480743272986,
											"behaviorType": "LineOfSight",
											"parameters": {
												"range": "clamp(lightSource.brightness * OriginalViewportWidth/100, lightAura.radius + 10, OriginalViewportWidth * .66)"
											}
										},
										{
											"type": "comment",
											"text": "needs to be more dynamic, 160 seems to be magic number"
										},
										{
											"id": "set-range",
											"objectClass": "lightAura",
											"sid": 622618680525981,
											"disabled": true,
											"behaviorType": "LineOfSight",
											"parameters": {
												"range": "clamp(lightSource.brightness * 300, lightAura.radius + 10, OriginalViewportWidth * .66)"
											}
										},
										{
											"type": "comment",
											"text": "needs to be more dynamic, 160 seems to be magic number"
										},
										{
											"id": "set-range",
											"objectClass": "lightAura",
											"sid": 627764935129244,
											"disabled": true,
											"behaviorType": "LineOfSight",
											"parameters": {
												"range": "clamp(160, lightAura.radius + 10, OriginalViewportWidth * .66)"
											}
										}
									],
									"sid": 141172332867697
								}
							]
						}
					],
					"sid": 968394290293492
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "Rim Light",
					"description": "",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "variable",
							"name": "lowIntensity",
							"type": "number",
							"initialValue": "0.04",
							"comment": "",
							"isStatic": false,
							"isConstant": true,
							"sid": 409126588507292
						},
						{
							"eventType": "variable",
							"name": "highIntensity",
							"type": "number",
							"initialValue": "0.25",
							"comment": "",
							"isStatic": false,
							"isConstant": true,
							"sid": 665385753615713
						},
						{
							"eventType": "variable",
							"name": "maxIntensity",
							"type": "number",
							"initialValue": "0.35",
							"comment": "",
							"isStatic": false,
							"isConstant": true,
							"sid": 291159790382361
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-created",
									"objectClass": "lightAura",
									"sid": 325711145159408
								}
							],
							"actions": [],
							"sid": 667129225895887,
							"children": [
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"callFunction": "setLightRadius",
											"sid": 292441468146938
										}
									],
									"sid": 835587397117424
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 656205276099383,
									"parameters": {
										"variable": "isLightingOn"
									}
								}
							],
							"actions": [],
							"sid": 732189825004817,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "for-each",
											"objectClass": "System",
											"sid": 113866837866264,
											"parameters": {
												"object": "dolls"
											}
										},
										{
											"id": "is-on-screen",
											"objectClass": "dolls",
											"sid": 630693772271064
										}
									],
									"actions": [],
									"sid": 197722619402290,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "pick-nearestfurthest",
													"objectClass": "lightAura",
													"sid": 663583672017549,
													"parameters": {
														"which": "nearest",
														"x": "dolls.X",
														"y": "dolls.Y"
													}
												},
												{
													"id": "is-on-screen",
													"objectClass": "lightAura",
													"sid": 910263960526174
												}
											],
											"actions": [
												{
													"callFunction": "drawLightRadiusLines",
													"sid": 385283444331477
												}
											],
											"sid": 408622999546398,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "evaluate-expression",
															"objectClass": "System",
															"sid": 775457115179995,
															"parameters": {
																"value": "distance(dolls.X, dolls.Y, lightAura.X, lightAura.Y) < lightAura.LineOfSight.Range"
															}
														}
													],
													"actions": [],
													"sid": 110352810919278,
													"children": [
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "has-los-to-object",
																	"objectClass": "lightAura",
																	"sid": 697345558716295,
																	"behaviorType": "LineOfSight",
																	"parameters": {
																		"object": "dolls",
																		"image-point": "0"
																	}
																}
															],
															"actions": [
																{
																	"id": "set-effect-enabled",
																	"objectClass": "dolls",
																	"sid": 227347944485968,
																	"parameters": {
																		"mode": "enable",
																		"effect": "\"RimLight\""
																	}
																},
																{
																	"callFunction": "fadeInRimLight",
																	"sid": 559650603375040
																}
															],
															"sid": 792528375730704
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "else",
																	"objectClass": "System",
																	"sid": 972258887953952
																}
															],
															"actions": [
																{
																	"callFunction": "fadeOutRimLight",
																	"sid": 243283535375098
																}
															],
															"sid": 281726186376054
														}
													]
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "else",
															"objectClass": "System",
															"sid": 442283102330509
														}
													],
													"actions": [
														{
															"id": "set-effect-enabled",
															"objectClass": "dolls",
															"sid": 443575144224090,
															"parameters": {
																"mode": "disable",
																"effect": "\"RimLight\""
															}
														}
													],
													"sid": 902730229164690
												}
											]
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 188356143380852
												}
											],
											"actions": [
												{
													"id": "set-effect-enabled",
													"objectClass": "dolls",
													"sid": 892212994701415,
													"parameters": {
														"mode": "disable",
														"effect": "\"RimLight\""
													}
												}
											],
											"sid": 625125993933040
										}
									]
								}
							]
						},
						{
							"functionName": "fadeOutRimLight",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": true,
							"functionIsAsync": false,
							"functionParameters": [],
							"eventType": "function-block",
							"conditions": [],
							"actions": [],
							"sid": 906690819894756,
							"children": [
								{
									"eventType": "variable",
									"name": "intensity",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 741509910948373
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-effect-enabled",
											"objectClass": "dolls",
											"sid": 435896201324982,
											"parameters": {
												"effect": "\"RimLight\""
											}
										}
									],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 503645300303417,
											"parameters": {
												"variable": "intensity",
												"value": "Functions.getObjectEffectValue(\"RimLight\", 2, dolls.UID)"
											}
										}
									],
									"sid": 324785639319951,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-two-values",
													"objectClass": "System",
													"sid": 980912182214721,
													"parameters": {
														"first-value": "intensity",
														"comparison": 4,
														"second-value": "0"
													}
												}
											],
											"actions": [
												{
													"callFunction": "drawRrimLight",
													"sid": 560115601112345,
													"parameters": [
														"lerp(intensity, 0, 0.1 * 120 * dt)"
													]
												}
											],
											"sid": 877924086321924
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 859301996993811
												}
											],
											"actions": [
												{
													"id": "set-effect-enabled",
													"objectClass": "dolls",
													"sid": 893773832645452,
													"parameters": {
														"mode": "disable",
														"effect": "\"RimLight\""
													}
												}
											],
											"sid": 142836834548214
										}
									]
								}
							]
						},
						{
							"functionName": "fadeInRimLight",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": true,
							"functionIsAsync": false,
							"functionParameters": [],
							"eventType": "function-block",
							"conditions": [],
							"actions": [],
							"sid": 405602998465186,
							"children": [
								{
									"eventType": "variable",
									"name": "curIntensity",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 352065970472392
								},
								{
									"eventType": "variable",
									"name": "potentialIntensity",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 731540843316779
								},
								{
									"eventType": "variable",
									"name": "curDistance",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 870051426927719
								},
								{
									"eventType": "variable",
									"name": "rateOfChange",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 763034487795684
								},
								{
									"eventType": "variable",
									"name": "finalDistance",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 545084528789289
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 208205221556542,
											"parameters": {
												"variable": "finalDistance",
												"value": "lightAura.radius"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 704394575709130,
											"parameters": {
												"variable": "rateOfChange",
												"value": "roundToDp((lowIntensity - highIntensity) / (lightAura.LineOfSight.Range - finalDistance), 5)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 839816277699351,
											"parameters": {
												"variable": "curDistance",
												"value": "distance(dolls.X, dolls.Y, lightAura.X, lightAura.Y)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 887872393286427,
											"parameters": {
												"variable": "potentialIntensity",
												"value": "clamp( lowIntensity - ((lightAura.LineOfSight.Range - curDistance) * rateOfChange), 0, highIntensity)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 618369850223288,
											"parameters": {
												"variable": "curIntensity",
												"value": "Functions.getObjectEffectValue(\"RimLight\", 2, dolls.UID)"
											}
										}
									],
									"sid": 512019404869916
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 213810179421877,
											"parameters": {
												"first-value": "potentialIntensity",
												"comparison": 4,
												"second-value": "highIntensity - .01"
											}
										}
									],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 273323025830281,
											"parameters": {
												"variable": "potentialIntensity",
												"value": "lerp(curIntensity, maxIntensity, 0.1 * 180 * dt)"
											}
										}
									],
									"sid": 490157032115091
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 729392107767478
										}
									],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 455311160053002,
											"parameters": {
												"variable": "potentialIntensity",
												"value": "lerp(curIntensity, potentialIntensity, 0.1 * 60 * dt)"
											}
										}
									],
									"sid": 367375322484368
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"callFunction": "drawRrimLight",
											"sid": 258443684976695,
											"parameters": [
												"potentialIntensity"
											]
										}
									],
									"sid": 546423520202389
								}
							]
						},
						{
							"functionName": "drawRrimLight",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": true,
							"functionIsAsync": false,
							"functionParameters": [
								{
									"name": "intensity",
									"type": "number",
									"initialValue": "-1",
									"comment": "",
									"sid": 972677546869532
								}
							],
							"eventType": "function-block",
							"conditions": [],
							"actions": [],
							"sid": 252479398774716,
							"children": [
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"type": "comment",
											"text": "color"
										},
										{
											"id": "set-effect-parameter",
											"objectClass": "dolls",
											"sid": 639338332312629,
											"parameters": {
												"effect": "\"RimLight\"",
												"parameter-index": "0",
												"value": "lightAura.ColorValue"
											}
										},
										{
											"type": "comment",
											"text": "size"
										},
										{
											"id": "set-effect-parameter",
											"objectClass": "dolls",
											"sid": 636364225399303,
											"parameters": {
												"effect": "\"RimLight\"",
												"parameter-index": "1",
												"value": "clamp(\n5-(distance(Self.X, Self.Y, lightAura.X, lightAura.Y)*0.005), 0, 2)"
											}
										},
										{
											"type": "comment",
											"text": "intensity"
										},
										{
											"id": "set-effect-parameter",
											"objectClass": "dolls",
											"sid": 902428757306041,
											"parameters": {
												"effect": "\"RimLight\"",
												"parameter-index": "2",
												"value": "intensity"
											}
										}
									],
									"sid": 311681923460139,
									"children": [
										{
											"eventType": "comment",
											"text": "angle"
										},
										{
											"eventType": "variable",
											"name": "angleDiffNum",
											"type": "number",
											"initialValue": "0",
											"comment": "",
											"isStatic": false,
											"isConstant": false,
											"sid": 880196493527183
										},
										{
											"eventType": "block",
											"conditions": [],
											"actions": [
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 857157199427194,
													"parameters": {
														"variable": "angleDiffNum",
														"value": "floor( anglediff(0, dolls.Angle))"
													}
												}
											],
											"sid": 161487218256884
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "is-mirrored",
													"objectClass": "dolls",
													"sid": 408915025767694,
													"isInverted": true
												}
											],
											"actions": [
												{
													"id": "set-effect-parameter",
													"objectClass": "dolls",
													"sid": 613843111160839,
													"parameters": {
														"effect": "\"RimLight\"",
														"parameter-index": "3",
														"value": "angle(Self.X, Self.Y, lightAura.X,lightAura.Y) - angleDiffNum"
													}
												}
											],
											"sid": 491221744393243
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 677366044175623
												}
											],
											"actions": [
												{
													"id": "set-effect-parameter",
													"objectClass": "dolls",
													"sid": 756254947498285,
													"parameters": {
														"effect": "\"RimLight\"",
														"parameter-index": "3",
														"value": "((angle(Self.X, Self.Y, lightAura.X,lightAura.Y) * -1) + 180) + angleDiffNum"
													}
												}
											],
											"sid": 592660806896543
										}
									]
								}
							]
						},
						{
							"functionName": "drawLightRadiusLines",
							"functionDescription": "",
							"functionCategory": "debug",
							"functionReturnType": "none",
							"functionCopyPicked": true,
							"functionIsAsync": false,
							"functionParameters": [],
							"eventType": "function-block",
							"conditions": [],
							"actions": [
								{
									"id": "destroy",
									"objectClass": "pathLine_spr",
									"sid": 542385492238761
								}
							],
							"sid": 456059244802275,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-boolean-eventvar",
											"objectClass": "System",
											"sid": 828060223835457,
											"parameters": {
												"variable": "isDebugMode"
											}
										}
									],
									"actions": [],
									"sid": 863857728046749,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "repeat",
													"objectClass": "System",
													"sid": 269874161991711,
													"parameters": {
														"count": "16"
													}
												}
											],
											"actions": [],
											"sid": 932613721347050,
											"children": [
												{
													"eventType": "block",
													"conditions": [],
													"actions": [
														{
															"id": "create-object",
															"objectClass": "System",
															"sid": 407354970413750,
															"parameters": {
																"object-to-create": "pathLine_spr",
																"layer": "\"characters\"",
																"x": "lightAura.X",
																"y": "lightAura.Y",
																"create-hierarchy": false,
																"template-name": "\"\""
															}
														},
														{
															"id": "add-child",
															"objectClass": "lightAura",
															"sid": 588365192406834,
															"parameters": {
																"child": "pathLine_spr",
																"transform-x": true,
																"transform-y": true,
																"transform-w": false,
																"transform-h": false,
																"transform-a": false,
																"transform-o": false,
																"transform-z-elevation": true,
																"transform-visibility": false,
																"destroy-with-parent": true
															}
														},
														{
															"id": "set-width",
															"objectClass": "pathLine_spr",
															"sid": 930735174567695,
															"parameters": {
																"width": "lightAura.LineOfSight.Range"
															}
														},
														{
															"id": "set-angle",
															"objectClass": "pathLine_spr",
															"sid": 821388743746043,
															"parameters": {
																"angle": "22.5 * loopindex "
															}
														}
													],
													"sid": 456876832926589
												}
											]
										}
									]
								}
							]
						}
					],
					"sid": 634265090156054
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "Shadow",
					"description": "",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-created",
									"objectClass": "ambientShadow",
									"sid": 847209429523480
								}
							],
							"actions": [
								{
									"id": "set-cast-from",
									"objectClass": "ambientShadow",
									"sid": 243816005867121,
									"parameters": {
										"cast-from": "same-tag"
									}
								},
								{
									"id": "set-tag",
									"objectClass": "ambientShadow",
									"sid": 997167389705049,
									"parameters": {
										"tag": "str(Self.UID)"
									}
								}
							],
							"sid": 459889950723205,
							"disabled": true
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-created",
									"objectClass": "dolls",
									"sid": 840011476940356
								},
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 252031242680641,
									"disabled": true,
									"parameters": {
										"variable": "isShadowsOn"
									}
								}
							],
							"actions": [
								{
									"id": "create-object",
									"objectClass": "System",
									"sid": 313786779890177,
									"parameters": {
										"object-to-create": "shadow",
										"layer": "\"shadows\"",
										"x": "dolls.X",
										"y": "dolls.Y",
										"create-hierarchy": true,
										"template-name": "\"\""
									}
								},
								{
									"id": "add-child",
									"objectClass": "dolls",
									"sid": 775847966147177,
									"parameters": {
										"child": "shadow",
										"transform-x": true,
										"transform-y": true,
										"transform-w": true,
										"transform-h": false,
										"transform-a": false,
										"transform-o": false,
										"transform-z-elevation": false,
										"transform-visibility": true,
										"destroy-with-parent": true
									}
								},
								{
									"id": "set-visible",
									"objectClass": "shadow",
									"sid": 915739921731436,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-height",
									"objectClass": "shadow",
									"sid": 583125884467748,
									"parameters": {
										"height": "dolls.Height"
									}
								}
							],
							"sid": 946030777731062
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 799271331490948,
									"parameters": {
										"variable": "isShadowsOn"
									}
								}
							],
							"actions": [],
							"sid": 529297094614282,
							"disabled": true,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "pick-nearestfurthest",
											"objectClass": "lightAura",
											"sid": 435448804944722,
											"parameters": {
												"which": "nearest",
												"x": "spr_playerActual.X",
												"y": "spr_playerActual.Y"
											}
										},
										{
											"id": "is-on-screen",
											"objectClass": "lightAura",
											"sid": 692487207263900
										}
									],
									"actions": [],
									"sid": 416044684927407,
									"disabled": true,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "evaluate-expression",
													"objectClass": "System",
													"sid": 578332129220209,
													"parameters": {
														"value": "distance(spr_playerActual.X, spr_playerActual.Y, lightAura.X, lightAura.Y) < lightAura.radius"
													}
												}
											],
											"actions": [],
											"sid": 961538398313669,
											"disabled": true,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "pick-children",
															"objectClass": "lightAura",
															"sid": 804052382493153,
															"parameters": {
																"child": "ambientShadow",
																"which": "own"
															}
														}
													],
													"actions": [],
													"sid": 827059657493253,
													"disabled": true,
													"children": [
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "has-los-to-object",
																	"objectClass": "lightAura",
																	"sid": 987691119693683,
																	"behaviorType": "LineOfSight",
																	"parameters": {
																		"object": "spr_playerActual",
																		"image-point": "0"
																	}
																}
															],
															"actions": [
																{
																	"id": "set-enabled",
																	"objectClass": "spr_playerActual",
																	"sid": 879270096559344,
																	"behaviorType": "ShadowCaster",
																	"parameters": {
																		"state": "enabled"
																	}
																},
																{
																	"id": "set-tag",
																	"objectClass": "spr_playerActual",
																	"sid": 338462339676351,
																	"behaviorType": "ShadowCaster",
																	"parameters": {
																		"tag": "str(ambientShadow.UID)"
																	}
																},
																{
																	"id": "set-visible",
																	"objectClass": "ambientShadow",
																	"sid": 827374076096933,
																	"parameters": {
																		"visibility": "visible"
																	}
																},
																{
																	"id": "set-layer-effect-enabled",
																	"objectClass": "System",
																	"sid": 945738727635235,
																	"parameters": {
																		"layer": "\"shadowLayer\"",
																		"mode": "enable",
																		"effect": "\"BlurVertical\""
																	}
																},
																{
																	"callFunction": "fadeInShadow",
																	"sid": 117755420752582
																}
															],
															"sid": 572987867946404,
															"disabled": true
														},
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "else",
																	"objectClass": "System",
																	"sid": 475433922505691
																}
															],
															"actions": [
																{
																	"id": "set-visible",
																	"objectClass": "ambientShadow",
																	"sid": 463204586056098,
																	"parameters": {
																		"visibility": "invisible"
																	}
																},
																{
																	"id": "set-layer-effect-enabled",
																	"objectClass": "System",
																	"sid": 159444536631504,
																	"parameters": {
																		"layer": "\"shadowLayer\"",
																		"mode": "disable",
																		"effect": "\"BlurVertical\""
																	}
																},
																{
																	"id": "set-enabled",
																	"objectClass": "spr_playerActual",
																	"sid": 437937858187786,
																	"behaviorType": "ShadowCaster",
																	"parameters": {
																		"state": "disabled"
																	}
																}
															],
															"sid": 261428202810414,
															"disabled": true
														}
													]
												}
											]
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 449474817291361
												}
											],
											"actions": [
												{
													"id": "set-visible",
													"objectClass": "ambientShadow",
													"sid": 117559689830545,
													"parameters": {
														"visibility": "invisible"
													}
												},
												{
													"id": "set-layer-effect-enabled",
													"objectClass": "System",
													"sid": 845342646886521,
													"parameters": {
														"layer": "\"shadowLayer\"",
														"mode": "disable",
														"effect": "\"BlurVertical\""
													}
												},
												{
													"id": "set-enabled",
													"objectClass": "spr_playerActual",
													"sid": 322092448573360,
													"behaviorType": "ShadowCaster",
													"parameters": {
														"state": "disabled"
													}
												}
											],
											"sid": 820049918475744,
											"disabled": true
										}
									]
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 969366788090401,
									"parameters": {
										"variable": "isShadowsOn"
									}
								}
							],
							"actions": [],
							"sid": 968780336572485,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "for-each",
											"objectClass": "System",
											"sid": 612149956453898,
											"parameters": {
												"object": "dolls"
											}
										},
										{
											"id": "is-on-screen",
											"objectClass": "dolls",
											"sid": 858449508071629
										}
									],
									"actions": [],
									"sid": 976322072436222,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "pick-nearestfurthest",
													"objectClass": "lightAura",
													"sid": 882645655617559,
													"parameters": {
														"which": "nearest",
														"x": "dolls.X",
														"y": "dolls.Y"
													}
												},
												{
													"id": "is-on-screen",
													"objectClass": "lightAura",
													"sid": 482460687984123
												}
											],
											"actions": [],
											"sid": 214770262971098,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "evaluate-expression",
															"objectClass": "System",
															"sid": 952609634316462,
															"parameters": {
																"value": "distance(dolls.X, dolls.Y, lightAura.X, lightAura.Y) < lightAura.radius"
															}
														}
													],
													"actions": [],
													"sid": 589827289137436,
													"children": [
														{
															"eventType": "block",
															"conditions": [
																{
																	"id": "pick-children",
																	"objectClass": "dolls",
																	"sid": 378438324516736,
																	"parameters": {
																		"child": "shadow",
																		"which": "own"
																	}
																}
															],
															"actions": [],
															"sid": 484388892072417,
															"children": [
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "has-los-to-object",
																			"objectClass": "lightAura",
																			"sid": 123333005908702,
																			"behaviorType": "LineOfSight",
																			"parameters": {
																				"object": "dolls",
																				"image-point": "0"
																			}
																		}
																	],
																	"actions": [
																		{
																			"id": "set-visible",
																			"objectClass": "shadow",
																			"sid": 700739266073584,
																			"parameters": {
																				"visibility": "visible"
																			}
																		},
																		{
																			"id": "set-layer-effect-enabled",
																			"objectClass": "System",
																			"sid": 595666276173685,
																			"disabled": true,
																			"parameters": {
																				"layer": "\"shadowLayer\"",
																				"mode": "enable",
																				"effect": "\"BlurVertical\""
																			}
																		},
																		{
																			"callFunction": "fadeInShadow2",
																			"sid": 570277023115448
																		}
																	],
																	"sid": 314025232844686
																},
																{
																	"eventType": "block",
																	"conditions": [
																		{
																			"id": "else",
																			"objectClass": "System",
																			"sid": 620930110311848
																		}
																	],
																	"actions": [
																		{
																			"id": "set-visible",
																			"objectClass": "shadow",
																			"sid": 898045587664113,
																			"parameters": {
																				"visibility": "invisible"
																			}
																		},
																		{
																			"id": "set-layer-effect-enabled",
																			"objectClass": "System",
																			"sid": 187413933162585,
																			"disabled": true,
																			"parameters": {
																				"layer": "\"shadowLayer\"",
																				"mode": "disable",
																				"effect": "\"BlurVertical\""
																			}
																		}
																	],
																	"sid": 352844241575125
																}
															]
														}
													]
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "else",
															"objectClass": "System",
															"sid": 947217717212921
														}
													],
													"actions": [
														{
															"id": "set-visible",
															"objectClass": "shadow",
															"sid": 191579363683913,
															"parameters": {
																"visibility": "invisible"
															}
														},
														{
															"id": "set-layer-effect-enabled",
															"objectClass": "System",
															"sid": 530937893540132,
															"disabled": true,
															"parameters": {
																"layer": "\"shadowLayer\"",
																"mode": "disable",
																"effect": "\"BlurVertical\""
															}
														}
													],
													"sid": 480353155332602
												}
											]
										}
									]
								}
							]
						},
						{
							"functionName": "fadeInShadow",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": true,
							"functionIsAsync": false,
							"functionParameters": [],
							"eventType": "function-block",
							"conditions": [],
							"actions": [],
							"sid": 310193628297972,
							"disabled": true,
							"children": [
								{
									"eventType": "variable",
									"name": "curIntensity",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 212819910935628
								},
								{
									"eventType": "variable",
									"name": "curDistance",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 964145980231527
								},
								{
									"eventType": "variable",
									"name": "potentialIntensity",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 890692853509381
								},
								{
									"eventType": "variable",
									"name": "distanceDifference",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 379840182105772
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 256554501249305,
											"parameters": {
												"variable": "curDistance",
												"value": "distance(spr_playerActual.X, spr_playerActual.Y, lightAura.X, lightAura.Y)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 211812422167146,
											"parameters": {
												"variable": "potentialIntensity",
												"value": "clamp( lightAura.radius - curDistance, 0, lightAura.radius * .85)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 620310594284063,
											"parameters": {
												"variable": "distanceDifference",
												"value": "lightAura.radius / potentialIntensity"
											}
										}
									],
									"sid": 580403276763246,
									"disabled": true
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 581918976481776,
											"parameters": {
												"first-value": "potentialIntensity",
												"comparison": 5,
												"second-value": "lightAura.radius * .75"
											}
										}
									],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 112111093849884,
											"breakpoint": true,
											"parameters": {
												"variable": "distanceDifference",
												"value": ".85"
											}
										}
									],
									"sid": 457456757003758
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-height",
											"objectClass": "spr_playerActual",
											"sid": 590273344415262,
											"behaviorType": "ShadowCaster",
											"parameters": {
												"height": "100 / distanceDifference"
											}
										},
										{
											"id": "set-layer-opacity",
											"objectClass": "System",
											"sid": 494255719443810,
											"parameters": {
												"layer": "\"shadowLayer\"",
												"opacity": "(Functions.calculateBellCurve(curDistance, lightAura.radius/2, lightAura.radius * .2) / 4)"
											}
										},
										{
											"id": "set-layer-opacity",
											"objectClass": "System",
											"sid": 530026436423404,
											"disabled": true,
											"parameters": {
												"layer": "\"shadowLayer\"",
												"opacity": "25 - ((100 / distanceDifference) / 8)"
											}
										}
									],
									"sid": 770417642792826,
									"disabled": true
								}
							]
						},
						{
							"functionName": "fadeInShadow2",
							"functionDescription": "",
							"functionCategory": "",
							"functionReturnType": "none",
							"functionCopyPicked": true,
							"functionIsAsync": false,
							"functionParameters": [],
							"eventType": "function-block",
							"conditions": [],
							"actions": [],
							"sid": 759800527357224,
							"children": [
								{
									"eventType": "variable",
									"name": "curDistance",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 533630754952448
								},
								{
									"eventType": "variable",
									"name": "potentialIntensity",
									"type": "number",
									"initialValue": "0",
									"comment": "",
									"isStatic": false,
									"isConstant": false,
									"sid": 797215683436373
								},
								{
									"eventType": "block",
									"conditions": [],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 454178115543872,
											"parameters": {
												"variable": "curDistance",
												"value": "distance(spr_playerActual.X, spr_playerActual.Y, lightAura.X, lightAura.Y)"
											}
										},
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 196799639956036,
											"parameters": {
												"variable": "potentialIntensity",
												"value": "clamp( lightAura.radius - curDistance, 0, lightAura.radius * .85)"
											}
										},
										{
											"id": "set-width",
											"objectClass": "shadow",
											"sid": 816667394547467,
											"parameters": {
												"width": "potentialIntensity"
											}
										},
										{
											"id": "set-angle-toward-position",
											"objectClass": "shadow",
											"sid": 705626003982760,
											"parameters": {
												"x": "lightAura.X",
												"y": "lightAura.Y"
											}
										},
										{
											"id": "destroy",
											"objectClass": "pathNode_spr",
											"sid": 326793510755043,
											"disabled": true
										},
										{
											"id": "create-object",
											"objectClass": "System",
											"sid": 437691679695621,
											"disabled": true,
											"parameters": {
												"object-to-create": "pathNode_spr",
												"layer": "\"characters\"",
												"x": "shadow.X+ potentialIntensity * cos(shadow.angle-180)",
												"y": "shadow.Y+ potentialIntensity * sin(shadow.angle-180)",
												"create-hierarchy": false,
												"template-name": "\"\""
											}
										},
										{
											"id": "cast-ray",
											"objectClass": "shadow",
											"sid": 231325277678812,
											"behaviorType": "LineOfSight",
											"parameters": {
												"from-x": "Self.X",
												"from-y": "Self.Y",
												"to-x": "Self.X+ potentialIntensity * cos(Self.angle-180)",
												"to-y": "Self.Y+ potentialIntensity * sin(Self.angle-180)",
												"use-collision-cells": true
											}
										}
									],
									"sid": 491796565279990
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "ray-intersected",
											"objectClass": "shadow",
											"sid": 998910313089993,
											"behaviorType": "LineOfSight"
										}
									],
									"actions": [
										{
											"id": "set-width",
											"objectClass": "shadow",
											"sid": 763474560548928,
											"parameters": {
												"width": "Self.LineOfSight.HitDistance"
											}
										}
									],
									"sid": 228400530504716
								}
							]
						}
					],
					"sid": 942117125694033
				}
			],
			"sid": 564661993524078
		}
	],
	"sid": 397859464194922
}